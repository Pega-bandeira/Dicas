### ğŸ“Œ **AnÃ¡lise da Vulnerabilidade (SQL Injection no Laravel)**

O cÃ³digo fornecido do **Laravel** apresenta **uma falha clÃ¡ssica de SQL Injection**, porque **o valor da variÃ¡vel `$searchTerm` Ã© inserido diretamente na query SQL**, sem qualquer sanitizaÃ§Ã£o ou uso de parÃ¢metros.

---

### ğŸ” **Como a vulnerabilidade funciona?**

No mÃ©todo `search()`, temos:

```php
$searchTerm = request('searchTerm');

$searchResult = DB::select("SELECT * FROM employees WHERE name like '%$searchTerm%'");
```

ğŸ“Œ Isso significa que **qualquer entrada fornecida pelo usuÃ¡rio serÃ¡ concatenada na query final**.

Por exemplo, se o usuÃ¡rio inserir:

```
'
```

A query final serÃ¡:

```sql
SELECT * FROM employees WHERE name like '%'%'
```

â¡ï¸ **Resultado:** Query invÃ¡lida â†’ **Erro 500** no servidor.

---

Agora, se o usuÃ¡rio inserir:

```
'--
```

A query final serÃ¡:

```sql
SELECT * FROM employees WHERE name like '%'--%'
```

â¡ï¸ O `--` inicia um comentÃ¡rio em SQL.
Tudo apÃ³s `--` Ã© **ignorado**, resultando em:

```sql
SELECT * FROM employees WHERE name like '%'
```

âœ… Como `%` Ã© um **coringa**, a query retorna **todos os funcionÃ¡rios**.

---

### âš  **Explorando a vulnerabilidade**

Um atacante pode usar `UNION SELECT` para **extrair dados de outras colunas**, como salÃ¡rios e datas de nascimento.

Exemplo de payload:

```
' UNION ALL SELECT name, salary, salary, salary, salary FROM employees --
```

â¡ï¸ Essa query **retorna o nome e repete o salÃ¡rio em todas as colunas** exibidas na tela.

---

### ğŸ” **Por que isso acontece?**

* **O Laravel permite execuÃ§Ã£o de SQL cru via `DB::select()`**, mas **nÃ£o faz escape automÃ¡tico de variÃ¡veis interpoladas**.
* **Ao concatenar `$searchTerm` diretamente**, o atacante **controla parte da query**.
* **Faltam consultas parametrizadas**, que sÃ£o a forma correta de evitar SQL Injection.

---

### âœ… **Como corrigir?**

A soluÃ§Ã£o Ã© **usar consultas parametrizadas** com `DB::select()`:

```php
$searchResult = DB::select(
    "SELECT * FROM employees WHERE name LIKE ?", 
    ['%' . $searchTerm . '%']
);
```

Ou, ainda melhor, **usar o Query Builder do Laravel** (mais seguro e legÃ­vel):

```php
$searchResult = DB::table('employees')
                  ->where('name', 'LIKE', '%' . $searchTerm . '%')
                  ->get();
```

---

### ğŸ”’ **Por que a correÃ§Ã£o funciona?**

* As **consultas parametrizadas** garantem que **qualquer valor fornecido pelo usuÃ¡rio seja tratado como texto**, nÃ£o como cÃ³digo SQL.
* Mesmo que o atacante insira `' UNION SELECT ...`, ele serÃ¡ tratado como **string literal**, e nÃ£o como parte da query.
