O cÃ³digo atual estÃ¡ assim:

```ruby
class SearchController < ApplicationController
  def search
    puts params.inspect
    result = ActiveRecord::Base.connection.exec_query("select title, content from posts where content like \"%"+ params[:query] +"%\";")
    render :html => result.rows
  end
end
```

ğŸ”´ **Problema:**
A query Ã© montada concatenando `params[:query]` diretamente no SQL â†’ isso permite **SQL Injection**.

---

### âœ… Como corrigir (usando ActiveRecord com query parametrizada):

```ruby
class SearchController < ApplicationController
  def search
    puts params.inspect
    result = Post.select(:title, :content).where("content LIKE ?", "%#{params[:query]}%")
    render :html => result.to_a
  end
end
```

---

### ğŸ”¹ O que mudou?

1. **SubstituÃ­mos `exec_query` por ActiveRecord ORM (`Post.select.where`)**
2. Usamos `?` como **placeholder**, garantindo que o valor de `params[:query]` seja escapado.
3. Adicionamos `%#{params[:query]}%` como parÃ¢metro para o LIKE.
4. Alteramos `result.rows` para `result.to_a`, que converte o ActiveRecord::Relation em array.

---

### ğŸ”¹ Como testar a vulnerabilidade antes da correÃ§Ã£o?

Acesse no navegador:

```
/search/"
```

â¡ï¸ Isso gera **erro 500**, confirmando que hÃ¡ injeÃ§Ã£o de SQL.

---
